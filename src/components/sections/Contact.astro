---
import { getItemsByFilter, getUploadsByIds } from "../../common/dato-client";
import { getLangFromUrl } from "../../data/utils";

const lang = getLangFromUrl(Astro.url);

const records = await getItemsByFilter("contact", lang);
const contactRecord: any = records.find(
    (r) => r.id === "CV2CdzpFSuWrU44V0YpNKw",
);
let contact: { id?: string; contactInfo?: string; directions?: any, contactImage?: any } = {};
if (contactRecord) {
    const contactImage = await getUploadsByIds([contactRecord.contactimage?.["upload_id"]]);
    const directionsImage = await getUploadsByIds([contactRecord.directions?.["upload_id"]]);
    contact = {
        directions: directionsImage[0],
        contactInfo: contactRecord?.contact,
        contactImage: contactImage[0],
        id: contactRecord.id
    };
}
---

<div
    class="md:flex justify-stretch border border-opacity-15 border-dark rounded-b-sm w-full text-lg"
>
    <div class="bg-primary text-light p-8 flex-1 flex-col flex">
        <img class="mx-auto bg-cover my-auto max-w-[200px] max-h-[200px]"
            src={contact.contactImage.url}
            alt={contact.contactImage.basename} />
        <div set:html={contact?.contactInfo} class="mt-5 text-lg flex-1 mx-auto" />
    </div>
    <div class="flex-1 self-center mx-auto">
        <img
            class="mx-auto hover:cursor-pointer bg-cover"
            id="dialog-img"
            src={contact.directions.url}
            alt={contact.directions.basename}
        />
    </div>
    <dialog
        class="backdrop:bg-black/50 backdrop:backdrop-blur-lg overflow-y-hidden"
    >
        <button autofocus class="absolute right-2">&times;</button>
        <img
            class="w-[100vw] m-auto md:w-2/3"
            id="dialog-img"
            src={contact.directions.url}
            alt={contact.directions.basename}
        />
    </dialog>
</div>
<script>
    const dialog = document.querySelector("dialog");
    const showButton = document.getElementById("dialog-img");
    const closeButton = document.querySelector("dialog button");

    // "Show the dialog" button opens the dialog modally
    showButton?.addEventListener("click", () => {
        dialog?.showModal();
    });

    // "Close" button closes the dialog
    closeButton?.addEventListener("click", () => {
        dialog?.close();
    });
</script>
